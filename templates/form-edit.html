{% extends "index.html" %}
{% load i18n %}{% load static %}
{% get_static_prefix as STATIC_URL %}


{% block head %}Анкета абитуриента{% endblock %}


{% block css %}
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/jquery-ui.css">
<style type="text/css">
.spec_range td{
    vertical-align: middle;
    text-align: center;
}

.spec_range input[type=radio]{
    margin-left:10px;
    margin-bottom:10px;
}

.ui-datepicker-trigger{
    line-height:400px;
}

.error input[type=text]{
    border: 1px solid red;
}

.message{
    display: none;
}

.error .message{
    display: inline !important;
}

.eduform_filter{
    width: 407px;
    height: 32px;
    margin: 5px 0;
}

.eduform_filter span{
    line-height: 32px;
    margin: 0 3px;
}

.eduform_filter input[type=checkbox]{
    vertical-align: middle;
    margin-bottom: 4px;
    margin-left:3px;
}

.eduform_filter.checked{
    background-color: #52A365;
    color: #fff;
}
</style>
{% endblock %}


{% block content %}
<div id="main-form" style="margin-top: 40px;font-family: segoe ui; font-size: 14px;border: 1px black solid;padding: 3%;">

<form action="/send/" id="glForm" name="glForm" method="post">

<div id="sform">
    <table id="start">
        <tbody>
            <tr>
                <td>
                    <p>
                    <h5 style="font-size: 18px; margin:0;padding: 0; color: #52A365;font-weight: normal">Уважаемый абитуриент!</h5>
                    <br />
                    Вы находитесь на странице дистанционной подачи заявлений в Ульяновский государственный университет. Аккуратно заполнив предлагаемую анкету, Вы существенно сократите время своего пребывания в пункте приёма заявлений.</p>
                    <p>
                    <h5 style="font-size: 18px; margin:0;padding: 0; color: #52A365;font-weight: normal">ВНИМАНИЕ!</h5>
                    <br />
                        Для завершения процедуры подачи документов, Вам необходимо <strong>лично</strong> предоставить полный комплект документов, предусмотренных правилами приёма в УлГУ в пункт приёма документов по адресу:<br />
                        <i><strong>г.Ульяновск, ул.Л.Толстого, 38</strong></i>, либо отправить необходимые документы почтой по адресу:<br> <i><strong>432017, г.Ульяновск, ул.Л.Толстого, д.42, Приёмная комиссия</strong></i>.</p>
                </td>
            </tr>
        </tbody>
    </table>

        <div class="form-big-block">
            <h4 class="h-big">Персональная информация</h4>

            <div class="form-block">
                <div class="form fio-form">

                    <label for="LastName">Фамилия:</label><br/>
                    <input disabled type="text"{% if v.LastName %} value="{{v.LastName}}"{% endif %} id="LastName" name="LastName" />
                </div>
                <div class="form fio-form">
                    <label for="FirstName">Имя:</label><br/>
                    <input type="text"{% if v.FirstName %} value="{{v.FirstName}}"{% endif %} id="FirstName" name="FirstName" />
                </div>
                <div class="form fio-form">
                    <label for="MiddleName">Отчество:</label><br/>
                    <input type="text"{% if v.MiddleName %} value="{{v.MiddleName}}"{% endif %} id="MiddleName" name="MiddleName" />
                </div>
                <div class="form">
                    <label for="BirthDay">Дата рождения
                        <span class="help"><nobr>(ГГГГ-ММ-ДД)</nobr></span>:
                    </label><br/>
                    <input type="text"{% if v.BirthDay %} value="{{v.BirthDay|date:"Y-m-d" }}"{% endif %} id="BirthDay" name="BirthDay" />
                </div>
            </div>

            <div class="form-block">
                <div class="form" style="margin-bottom: 40px;">
                    <label for="IDSex">Пол:</label><br/>
                    <div style="float: left; margin-right: 10px;">
                        <input type="radio"{% if v.IDSex == 1 %} checked="checked"{% endif %} id="IDSexM" value="1" name="IDSex">Мужской
                    </div>
                    <div style="float: left; margin-right: 10px;">
                        <input type="radio"{% if v.IDSex == 2 %} checked="checked"{% endif %} id="IDSexG" value="2" name="IDSex">Женский
                    </div>    
                </div>
                <div style="clear: both;"></div>
                <div class="form">
                    <label for="IDSocialStatus">Социальный статус:</label><br/><br/>
                    <select id="IDSocialStatus" name="IDSocialStatus">
                        <option value=""></option>
                        {% for item in IDSocialStatus %}
                        <option{% if v.IDSocialStatus.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form">
                    <label for="Nationality">Национальность:</label><br/><br/>
                    <select id="Nationality" name="Nationality">
                        <option value=""></option>
                        {% for item in Nationality %}
                        <option{% if v.Nationality.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form">
                    <label for="Citizenship">Гражданство:</label><br/><br/>
                    <select id="Citizenship" name="Citizenship">
                        <option value=""></option>
                        {% for item in Country %}
                        <option{% if v.Citizenship.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}     
                    </select>
                </div>
            </div>
        </div>

        <div class="form-big-block">
            <h4 class="h-small">Паспортные данные</h4>

            <div class="form-block">
                <div class="form">
                    <label for="PassportSer">Серия (<span class="help">4 цифры без пробелов</span>):</label><br/>
                    <input type="text"{% if v.PassportSer %} value="{{v.PassportSer}}"{% endif %} id="PassportSer" name="PassportSer" />
                    <span class="message">Неправильный формат поля 'Серия' ! Нужно 'XXXX', где X - цифра.</span>
                </div>
                <div class="form">
                    <label for="PassportNumb">Номер:</label><br/>
                    <input type="text"{% if v.PassportNumb %} value="{{v.PassportNumb}}"{% endif %} id="PassportNumb" name="PassportNumb" />
                    <span class="message">Неправильный формат поля 'Номер' ! Нужно 'XXXXXX', где X - цифра.</span>
                </div>
                <div class="form">
                    <label for="CodUVD">Код подразделения УВД:</label><br/>
                    <input type="text"{% if v.CodUVD %} value="{{v.CodUVD}}"{% endif %} id="CodUVD" name="CodUVD" />
                </div>
                <div class="form">
                    <label for="PassportDate">Дата выдачи паспорта (<span class="help"><nobr>ГГГГ-ММ-ДД</nobr></span>):</label><br/>
                    <input type="text"{% if v.PassportDate %} value="{{v.PassportDate|date:"Y-m-d"}}"{% endif %} id="PassportDate" name="PassportDate" />
                </div>
                <div class="form">
                    <label for="BirthPlace">Место рождения (<span class="help">по паспорту</span>):</label><br/>
                    <input type="text" size="80"{% if v.BirthPlace %} value="{{v.BirthPlace}}"{% endif %} id="BirthPlace" name="BirthPlace" />
                </div>
                <div class="form">
                    <label for="PassportIssued">Кем выдан паспорт:</label><br/>
                    <input type="text" size="80"{% if v.PassportIssued %} value="{{v.PassportIssued}}"{% endif %} id="PassportIssued" name="PassportIssued" />
                </div>
            </div>
        </div>

        <div class="form-big-block">
            <h4 class="h-small">Прописка</h4>

            <div class="form-block">
                <div class="form">
                    <label for="Country">Страна:</label><br/><br/>
                    <select id="Country" name="Country">
                        <option value=""></option>
                         {% for item in Country %}
                        <option{% if v.PrCountry.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}     
                    </select>
                </div>

                <div class="form">
                    <label for="Region">Регион:</label><br/><br/>
                    <select{% if not v.PrCountry.id and v.PrCountry.id != 10 %} disabled{% endif %} id="Region" name="Region">
                        <option value=""></option>
                        {% for item in Region %}
                        <option{% if v.PrRegion.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}    
                    </select>
                </div>

                <div class="form">
                    <label for="Locality">Населённый пункт:</label><br/>
                    <input{% if not v.PrRegion.id %} disabled{% endif %} size="30"{% if v.PrLocality %} value="{{v.PrLocality.name}}" {% endif %} type="text" id="LocalityName" name="LocalityName" />
                    <input type="hidden"{% if v.PrLocality %} value="{{v.PrLocality.id}}" {% endif %} id="Locality" name="Locality" />                        
                </div>

                <div class="form">
                    <label for="Street">Улица:</label><br/>
                    <input{% if not v.PrRegion or not v.PrLocality %} disabled{% endif %}{% if v.PrStreet %} value="{{v.PrStreet.name}}" {% endif %} type="text" id="StreetName" name="StreetName" />
                    <input type="hidden"{% if v.PrStreet %} value="{{v.PrStreet.id}}" {% endif %} id="Street" name="Street" />    
                </div>

                <div class="form">
                    <label for="House">Дом:</label><br/>
                    <input{% if not v.PrRegion or not v.PrLocality %} disabled{% endif %} type="text"{% if v.PrHouse %} value="{{v.PrHouse}}"{% endif %} id="House" name="House" />
                </div>

                <div class="form">
                    <label for="Apartment">Квартира:</label><br/>
                    <input{% if not v.PrRegion or not v.PrLocality %} disabled{% endif %} type="text"{% if v.PrApartment %} value="{{v.PrApartment}}" {% endif %} id="Apartment" name="Apartment" />
                </div>

                <div class="form">
                    <label for="Index">Индекс:</label><br/>
                    <input type="text"{% if v.PrIndex %} value="{{v.PrIndex}}" {% endif %} id="Index" name="Index" /><br/>
                    <a href="http://temp8.ulsu.ru/" target="_blank" class="link">Узнать свой почтовый индекс</a>
                </div>
            </div>

            <div class="form-block">
                <div class="form">
                    <label for="Telephone">Контактный телефон:</label><br/>
                    <input type="text"{% if v.Telephone %} value="{{v.Telephone}}" {% endif %} id="Telephone" name="Telephone" />
                </div>
                <div class="form">
                    <label for="Email">E-mail:</label><br/>
                    <input type="text"{% if v.Email %} value="{{v.Email}}" {% endif %} id="Email" name="Email" />
                </div>
                <div class="form">
                    <label for="IDMilitaryService">Отношение к воинской службе:</label><br/><br/>
                    <select id="IDMilitaryService" name="IDMilitaryService">
                        <option value=""></option>
                        {% for item in MilitaryStatus %}
                        <option{% if v.IDMilitaryService.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}                                         
                    </select>
                </div>
            </div>

        </div>

        <div class="form_check">
            <input type="checkbox"{% if v.prp %} checked=""{% endif %} id="prp" name="prp" style="width: 13px; height: 13px;"/>
            <label for="prp">Фактический адрес и прописка совпадают</label>
        </div>
        
        <div class="form-big-block" id="prp-block"{% if v.prp %} style="display:none;"{% endif %}>

            <h4 class="h-small">Адрес фактического проживания</h4>

            <div class="form-block">
                <div class="form">
                    <label for="liveCountry">Страна:</label><br/><br/>
                    <select id="LiveCountry" name="LiveCountry">
                        <option value=""></option>
                         {% for item in Country %}
                        <option{% if v.LiveCountry.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}     
                    </select>
                </div>

                <div class="form">
                    <label for="LiveRegion">Регион:</label><br/><br/>
                    <select{% if v.LiveCountry.id != 10 %} disabled{% endif %} id="LiveRegion" name="LiveRegion">
                        <option value=""></option>
                        {% for item in Region %}
                        <option{% if v.LiveRegion.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}    
                    </select>
                </div>

                <div class="form">
                    <label for="LiveLocality">Населённый пункт:</label><br/>
                    <input{% if not v.LiveRegion %} disabled{% endif %} size="30"{% if v.LiveLocality and v.LiveRegion %} value="{{v.LiveLocality.name}}" {% endif %} type="text" id="LiveLocalityName" name="LiveLocalityName" />
                    <input type="hidden"{% if v.LiveLocality and v.LiveRegion %} value="{{v.LiveLocality.id}}" {% endif %} id="LiveLocality" name="LiveLocality" />                        
                </div>

                <div class="form">
                    <label for="LiveStreet">Улица:</label><br/>
                    <input{% if not v.LiveRegion or not v.LiveLocality %} disabled{% endif %}{% if v.LiveStreet %} value="{{v.LiveStreet.name}}" {% endif %} type="text" id="LiveStreetName" name="LiveStreetName" />
                    <input type="hidden"{% if v.LiveStreet %} value="{{v.LiveStreet.id}}" {% endif %} id="LiveStreet" name="LiveStreet" />    
                </div>

                <div class="form">
                    <label for="LiveHouse">Дом:</label><br/>
                    <input type="text"{% if v.LiveHouse and v.LiveRegion and v.LiveLocality %} value="{{v.LiveHouse}}" {% endif %} id="LiveHouse" name="LiveHouse" />
                </div>

                <div class="form">
                    <label for="LiveApartment">Квартира:</label><br/>
                    <input type="text"{% if v.LiveApartment and v.LiveHouse and v.LiveRegion and v.LiveLocality %} value="{{v.LiveApartment}}" {% endif %} id="LiveApartment" name="LiveApartment" />
                </div>

                <div class="form">
                    <label for="LiveIndex">Индекс:</label><br/>
                    <input type="text"{% if v.LiveIndex %} value="{{v.LiveIndex}}" {% endif %} id="LiveIndex" name="LiveIndex" /><br/>
                    <a class="link" href="http://temp8.ulsu.ru/" target="_blank">Узнать свой почтовый индекс</a>
                </div>
            </div>
        </div>

        <div class="form-big-block">

            <h4 class="h-small">Прочая информация</h4>

            <div class="form-block">
                <div class="form-check">
                    <input type="checkbox"{% if v.Hostel %} checked=""{% endif %} id="Hostel" name="Hostel" />
                    <label for="Hostel">Необходимость в общежитии на период обучения (для поступающих на бюджетную форму обучения)</label>
                </div>

                <div class="form">
                    <label for="ForeignLanguage">Иностранный язык, который изучал в школе, либо который собирается сдавать при поступлении (свидетельство ЕГЭ):</label><br/><br/>
                    <select id="ForeignLanguage" name="ForeignLanguage">
                        <option value=""></option>
                         {% for item in Language %}
                        <option{% if v.ForeignLanguage.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}
                    </select>
                    <div class="clear"></div>
                </div>

                <div class="form">
                    <label for="LengthServiceTotal">Общий трудовой стаж (<span class="help">в месяцах</span>):</label><br/>
                    <input type="text"{% if v.LengthServiceTotal %} value="{{v.LengthServiceTotal}}"{% endif %} id="LengthServiceTotal" name="LengthServiceTotal" />                    
                </div>

                <div class="form">
                    <label for="PrivIDPrivileges">Наличие льгот:</label><br/><br/>
                    <select id="PrivIDPrivileges" name="PrivIDPrivileges">
                        <option value=""></option>
                         {% for item in Privilege %}
                        <option{% if v.PrivIDPrivileges.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}                             
                    </select>
                </div>
            </div>
        </div>

        <div class="form-big-block">
            <h4 class="h-big">Образование</h4>
            <div id="edu-list"{% if v.schoolSel %} style="display:none;"{% endif %} class="form-block">
                <div class="form">
                    <label for="schoolRjn">Регион:</label><br/><br/>
                    <select id="schoolRjn" name="schoolRjn">
                        <option value=""></option>
                         {% for item in EduRegion %}
                        <option{% if v.schoolRjn.id == item.id and not v.schoolSel %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}        
                    </select>
                </div>
                <div {% if not v.schoolRjn or v.schoolSel %} style="display:none;"{% endif %} class="form">
                    <label for="schoolCity">Населенный пункт:</label><br/><br/>
                    <select id="schoolCity" name="schoolCity">
                        <option value=""></option>
                        {% if EduLocality and v.schoolRjn and not v.schoolSel %}
                         {% for item in EduLocality %}
                        <option{% if v.schoolCity.id == item.id and not v.schoolSel %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}    
                        {% endif %}
                    </select>    
                </div>
                <div {% if not v.schoolCity or v.schoolSel %} style="display:none;"{% endif %} class="form">
                    <label for="schoolName">Учебное заведение:</label><br/><br/>
                    <select id="schoolName" name="schoolName">
                        <option value=""></option>
                        {% if EduInstitute and v.schoolRjn and v.schoolCity and not v.schoolSel %}
                         {% for item in EduInstitute %}
                        <option{% if v.schoolName.id == item.id and not v.schoolSel %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}    
                        {% endif %}
                    </select>        
                </div>
            </div>

            <div class="form_check">
                <input type="checkbox"{% if v.schoolSel %} checked=""{% endif %} id="schoolSel" name="schoolSel" style="width:13px; height:13px;"/>
                <label for="schoolSel">Моего учебного заведения нет в приведённом списке</label><br/><br/>
            </div>

            <div id="edu-non-list"{% if not v.schoolSel %} style="display:none;"{% endif %} class="form-block">
                <div class="form">
                    <label for="EduCountry">Страна:</label><br/><br/>
                    <select id="EduCountry" name="EduCountry">
                        <option value=""></option>
                         {% for item in Country %}
                        <option{% if v.EduCountry.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}     
                    </select>
                </div>

                <div class="form">
                    <label for="EduRegion">Регион:</label><br/><br/>
                    <select{% if not v.EduCountry %} disabled{% endif %} id="EduRegion" name="EduRegion">
                        <option value=""></option>
                        {% for item in Region %}
                        <option{% if v.EduRegion.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}    
                    </select>
                </div>

                <div class="form">
                    <label for="EduLocality">Населённый пункт:</label><br/>
                    <input{% if not v.EduRegion %} disabled{% endif %} size="30"{% if v.EduLocality %} value="{{v.EduLocality.name}}"{% endif %} type="text" id="EduLocalityName" name="EduLocalityName" />
                    <input type="hidden"{% if v.EduLocality %} value="{{v.EduLocality.id}}"{% endif %} id="EduLocality" name="EduLocality" />                        
                </div>
                
                <div class="form">
                    <label for="EduInstituteType">Тип учебного заведения:</label><br/><br/>
                    <select id="EduInstituteType" name="EduInstituteType">
                        <option value=""></option>
                        {% for item in InstituteType %}
                        <option{% if v.EduInstituteType.id == item.id and v.schoolSel %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}    
                    </select>
                </div>

                <div class="form">
                    <label for="EduInstituteName">Название учебного заведения:</label><br/>
                    <input type="text"{% if v.EduInstituteName %} value="{{v.EduInstituteName}}"{% endif %} id="EduInstituteName" name="EduInstituteName" />
                </div>

                <div class="form">
                    <label for="EduInstituteDescription">Описание учебного заведения:</label><br/>
                    <input type="text"{% if v.EduInstituteDescription %} value="{{v.EduInstituteDescription}}"{% endif %} id="EduInstituteDescription" name="EduInstituteDescription" />
                </div>
            </div>

            <div class="form-block">
                <div class="form">
                    <label for="EduDiplomType">Документ об образовании:</label><br/><br/>
                    <select id="EduDiplomType" name="EduDiplomType">
                        <option value=""></option>
                        {% for item in DiplomType %}
                        <option{% if v.EduDiplomType.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form">
                    <label for="EduEducationType">Вид образования:</label><br/><br/>
                    <select id="EduEducationType" name="EduEducationType">
                        <option value=""></option>
                        {% for item in EducationType %}
                        <option{% if v.EduEducationType.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>
                        {% endfor %}
                    </select>                                     
                </div>

                <div class="form">
                    <label for="EduDateIN">Дата поступления (<span class="help">ГГГГ-ММ-ДД</span>):</label><br/>
                    <input type="text"{% if v.EduDateIN %} value="{{v.EduDateIN|date:"Y-m-d" }}"{% endif %} id="EduDateIN" name="EduDateIN" />
                </div>

                <div class="form">
                    <label for="EduDateOUT">Дата окончания (<span class="help">ГГГГ-ММ-ДД</span>):</label><br/>
                    <input type="text"{% if v.EduDateOUT %} value="{{v.EduDateOUT|date:"Y-m-d" }}"{% endif %} id="EduDateOUT" name="EduDateOUT" />
                </div>

                <div class="form">
                    <label for="EduDiplomspeciality">Специальность (<span class="help">по документу об образовании</span>):</label><br/>
                    <input type="text"{% if v.EduDiplomspeciality %} value="{{v.EduDiplomspeciality }}"{% endif %} id="EduDiplomspeciality" name="EduDiplomspeciality" />
                </div>

                <h4 class="h-small">Документ об образовании</h4>
                <div class="form">
                    <label for="EduSeriaDiplom">Серия:</label><br/>
                    <input type="text" size="8"{% if v.EduSeriaDiplom %} value="{{v.EduSeriaDiplom }}"{% endif %} id="EduSeriaDiplom" name="EduSeriaDiplom" />
                </div>
                
                <div class="form">
                    <label for="EduNumberDiplom">Номер:</label><br/>
                    <input type="text"{% if v.EduNumberDiplom %} value="{{v.EduNumberDiplom }}"{% endif %} id="EduNumberDiplom" name="EduNumberDiplom" />
                </div>
                
            </div>
        </div>

        <div class="form-big-block">
            <h4 class="h-big">Данные о результатах ЕГЭ</h4>
            <div id="repeater-exam">
                <div id="repeater-exam-items">
                </div>
                <div id="repeater-exam-item-adder">Добавить результат ЕГЭ</div>
            </div>
        </div>

        <div class="form-big-block">
            <h4 class="h-small">Данные о специальностях, на которые поступает абитуриент</h4>
            <div id="repeater-spec" style="margin-top: 5px;">
                <div id="repeater-spec-items"></div>
                <div id="repeater-spec-item-adder">Добавить специальность</div>
            </div>
        </div>

        <div class="form-big-block">
            <h4 class="h-small">Информация о довузовском образовании, полученном при УлГУ</h4>
            <div class="form">
                <label for="UlsuIDStructure">Вид довузовского образования:</label><br/><br/>
                <select id="UlsuIDStructure" name="UlsuIDStructure">
                    <option value=""></option>
                    {% for item in Cource %}
                    <option{% if v.UlsuIDStructure.id == item.id %} selected{% endif %} value="{{item.id}}">{{item.name}}</option>        
                    {% endfor %}                                 
                </select>
            </div>
            <div class="form">
                <label for="UlsuDateIn">Дата начала (<span class="help">ГГГГ-ММ-ДД</span>):</label><br/>
                <input type="text"{% if v.UlsuDateIn %} value="{{v.UlsuDateIn|date:"Y-m-d" }}"{% endif %} id="UlsuDateIn" name="UlsuDateIn" />
            </div>
            <div class="form">
                <label for="UlsuDateOut">Дата окончания (<span class="help">ГГГГ-ММ-ДД</span>):</label><br/>
                <input type="text"{% if v.UlsuDateOut %} value="{{v.UlsuDateOut|date:"Y-m-d" }}"{% endif %} id="UlsuDateOut" name="UlsuDateOut" />
            </div>
            <div class="clear"></div>
        </div>

        {% if edit %}<div class="form-big-block">
            <div class="form_check">
                <input type="checkbox"{% if v.Original %} checked=""{% endif %} id="Original" name="Original" style="width: 13px; height: 13px;"/>
                <label for="Original">Предоставлен оригинал документа об образовании</label>
            </div>
        </div>{% endif %}

        <div class="form-big-block">
              {% csrf_token %}
            {% if edit %}<input type="hidden" id="user_id" name="user_id" value="{{v.user.id}}" />{% endif %}
            <input type="submit" id="saveForm" value="Сохранить" class="button_save"/>
            <div id="button_next"><div id="arrow"></div></div>Сохранить
        </div>
</div>

</form>
</div>


{% endblock %}



{% block js %}
<script src="{{STATIC_URL}}js/jquery.ui.datepicker-ru.js"></script>
<script src="{{STATIC_URL}}js/jquery.json2html-3.1-min.js"></script>
<script src="{{STATIC_URL}}js/jquery.selectbox.js"></script>
<script src="{{STATIC_URL}}js/form/address.js"></script>
<script>

    var global = {
        specialities: [{% for spec in SpecialityName %}
            {id:{{spec.id}}, name:"{{spec.name}}"},{% endfor %}
        ],

        faculties: [{% for fac in Faculty %}
            {id:{{fac.id}}, name:"{{fac.name}}"},{% endfor %}
        ],

        edu_forms: [{% for ef in EduForm %}
            {id:{{ef.id}}, name:"{{ef.name}}"},{% endfor %}
        ],

        spec_ranges: [0, 0, 0],
        radio_count: 0,
        'zel': [16, 17, 19]
    };


    Array.prototype.in_array = function (needle) {
        for (var i = 0; i < this.length; i++) if (this[ i] === needle) return true;
        return false;
    };


    function intersecting(one, two){
        var intersection = [];
        for (var i=0;i<two.length;i++){
            for (var j=0; j<one.length; j++){
                if (two[i]==one[j]){
                    intersection.push(one[j]);
                }
            }
        }
        return intersection;
    }

    function get_specs(id){
        var specs = [{id:'', name:''}];
        var tmp;
        for(var i=0; i<global.specialities.length; i++){
            tmp = {id: global.specialities[i].id, name: global.specialities[i].name};
            if (tmp.id == id){
                tmp.selected = true;
            }
            specs.push(tmp);
        }
        return specs;
    }


    function get_facs(active, selected){
        var facs = [{id:'', name:''}];
        var tmp;
        for(var i=0; i<global.faculties.length; i++){
            tmp = {id: global.faculties[i].id, name: global.faculties[i].name};
            if (tmp.id == selected){
                tmp.selected = true;
            }
            if (jQuery.inArray(tmp.id, active) != -1) facs.push(tmp);
        }
        return facs;
    }

    function get_edu_forms(active, checked){
        var eforms = [];
        var tmp;
        var j;
        for(var i=0; i<global.edu_forms.length; i++){
            tmp = {id: global.edu_forms[i].id, name: global.edu_forms[i].name};
            for (j in checked){
                if (tmp.id == checked[j]){
                    tmp.checked = true;
                    break;
                }
            }
            for (j in active){
                if (tmp.id == active[j]){
                    eforms.push(tmp);
                    break;
                }
            }
        }
        return eforms;
    }



    selected_region = '0';

    $(function() {
        $('select').trigger('refresh');

        $("#EduDateOUT").datepicker({
            dateFormat: "yy-mm-dd",
            changeMonth: true,
            changeYear: true
        });
        
        $("#UlsuDateIn, #EduDateIN, #BirthDay, #PassportDate").datepicker({
            dateFormat: "yy-mm-dd",
            changeMonth: true,
            changeYear: true,
            maxDate: 0
        });
        $("#UlsuDateOut").datepicker({
            dateFormat: "yy-mm-dd",
            changeMonth: true,
            changeYear: true,
            maxDate: new Date(2013, 7, 31)
        });
        
        var repeaterExamItem = [{
                tag: 'div',
                'class': 'repeater-item',
                children:[{

                        tag: 'div',
                        'class': 'form',
                        children: [{
                                tag: 'label',
                                'for': 'EgNumber',
                                html: 'Номер свидетельства ЕГЭ:'
                        },
                        {tag: 'br'},
                        {
                                tag: 'input',
                                type: 'text',
                                'class': 'EgNumber',
                                name: 'EgNumber[]',
                                value: '${number}'
                        }]
                },{
                        tag: 'div',
                        'class': 'form',
                        children: [{
                                tag: 'label',
                                'for': 'EgExamName',
                                html: 'Название экзамена ЕГЭ:'
                        },
                        {tag: 'br'},
                        {tag: 'br'},
                        {
                                tag: 'select',
                                'class': 'EgExamName',
                                name: 'EgExamName[]',
                                children: [{
                                        tag: 'option',
                                        value: ''
                                }
                                {% for item in ExamName %}
                                ,{
                                        tag: 'option',
                                        value: '{{item.id}}',
                                        html: '{{item.name}}',
                                        selected:function(){return (this.name=={{item.id}});}
                                }
                                {% endfor %}
                                ]
                        }]
                },
                {
                        tag: 'div',
                        'class': 'form',
                        children: [{
                                tag: 'label',
                                'for': 'EgMark',
                                html: 'Количество баллов:'
                        },
                        {tag: 'br'},
                        {
                                tag: 'input',
                                type: 'text',
                                'class': 'EgMark',
                                name: 'EgMark[]',
                                value: '${mark}'
                        }]
                },{
                        tag: 'h4',
                        html: 'Паспорт, с которым сдавал этот ЕГЭ'
                },{
                        tag: 'div',
                        'class': 'form form',
                        children: [{
                                tag: 'label',
                                'for': 'EgDocSer',
                                html: 'Серия (<span class="help">без пробелов</span>):'
                        },
                        {tag: 'br'},
                        {
                                tag: 'input',
                                size: '8',
                                type: 'text',
                                'class': 'EgDocSer',
                                name: 'EgDocSer[]',
                                value: '${docser}'
                        }]
                },{
                        tag: 'div',
                        'class': 'form form',
                        children: [{
                                tag: 'label',
                                'for': 'EgDocNum',
                                html: 'Номер (<span class="help">без пробелов</span>):'
                        },
                        {tag: 'br'},
                        {
                                tag: 'input',
                                type: 'text',
                                'class': 'EgDocNum',
                                name: 'EgDocNum[]',
                                value: '${docnum}'
                        }]
                },
                {tag: 'div', 'class': 'clear'},
                {tag: 'div',
                    'class': 'del-repeater-exam-item',
                    style: 'margin: -30px 10px 0 0',
                    html: '<div id="button_del"><div class="krest"></div></div>'}
                ]
            }];


        var repeaterSpecItem = {
            item:[{
                tag: 'div',
                'class': 'repeater-item',
                children:[{
                    tag: 'input',
                    'type': 'hidden',
                    'name': 'SpecItem[]',
                    'value': '1'

                },{
                    tag: 'div',
                    'class': 'form',
                    children: [{
                        tag: 'label',
                        'for': 'Speciality',
                        html: 'Специальность:'
                    },{tag: 'br'},{tag: 'br'},{
                        tag: 'select',
                        'class': 'Speciality',
                        name: 'Speciality[]',
                        children: function(){return($.json2html(this.specs,repeaterSpecItem.option));}
                    }]

                },{
                    tag: 'div',
                    'class': 'form',
                    style: function(){if (!this.show_facs) return "display:none;"; else return false;},
                    children: [{
                        tag: 'label',
                        'for': 'Faculty',
                        html: 'Факультет:'
                    },{tag: 'br'},{tag: 'br'},{
                        tag: 'select',
                        'class': 'Faculty',
                        name: 'Faculty[]',
                        children: function(){return($.json2html(this.facs,repeaterSpecItem.option));}
                    }]
                },{
                    tag: 'div',
                    'class': 'form',
                    style:function(){if (!this.show_edu_forms) return "display:none;"; else return '';},
                    children: [{
                        tag: 'label',
                        'for': 'Faculty',
                        html: 'Форма обучения:'
                    },{tag: 'br'},{
                        tag: 'div',
                        'class': 'filter_body',
                        children: function(){return($.json2html(this.edu_forms,repeaterSpecItem.filter));}
                    },{
                        tag: 'input',
                        type: 'hidden',
                        name: 'EduForm[]',
                        value: '${hidden_value}'
                    },{
                        tag: 'div',
                        'class': 'message',
                        'style': function(){return (intersecting(this.hidden_value.split(','),global.zel).length > 0)?'display:block;':'';},
                        'html': function(){var l=false; if (intersecting(this.hidden_value.split(','),global.zel).length > 0) {return 'Для поступления на целевой набор, вы должны предоставить договор с предприятием';} else {return '';} }
                    }]
                },{
                        tag: 'div',
                        'class': 'form',
                        children: [{
                                tag: 'table',
                                'class': 'spec_range',
                                cellpadding: '5',
                                children: [{
                                    tag: 'tr',
                                    children: [{
                                        tag: 'td'
                                    },{
                                        tag: 'td',
                                        html: '1'
                                    },{
                                        tag: 'td',
                                        html: '2'
                                    },{
                                        tag: 'td',
                                        html: '3'
                                    }]
                                },{
                                    tag: 'tr',
                                    children: [{
                                        tag: 'td',
                                        children:[{
                                            tag: 'label',
                                            html: 'Приоритет зачисления:'
                                        }]
                                    },{
                                        tag: 'td',
                                        children:[{
                                            tag: 'input',
                                            type: 'radio',
                                            'class': 'SpecRangeRadio',
                                            name: 'SpecRange_${radio}',
                                            value:'1',
                                            checked: function(){return (this.radio_v == '1');  }
                                        }]
                                    },{
                                        tag: 'td',
                                        children:[{
                                            tag: 'input',
                                            type: 'radio',
                                            'class': 'SpecRangeRadio',
                                            name: 'SpecRange_${radio}',
                                            value:'2',
                                            checked: function(){return (this.radio_v == '2');  }
                                        }]
                                    },{
                                        tag: 'td',
                                        children:[{
                                            tag: 'input',
                                            type: 'radio',
                                            'class': 'SpecRangeRadio',
                                            name: 'SpecRange_${radio}',
                                            value:'3',
                                            checked: function(){return (this.radio_v == '3');  }
                                        }]
                                    }]
                                }]
                        },{
                                tag: 'input',
                                type: 'hidden',
                                'class': 'SpecRange',
                                name: 'SpecRange[]',
                                value: '${radio_v}'
                        }]
                },{

                        tag: 'div',
                        'class': 'form',
                        children: [{
                                tag: 'label',
                                'for': 'SpecStream',
                                html: 'Поток:'
                        },
                        {tag: 'br'},
                        {tag: 'br'},
                        {
                                tag: 'select',
                                'class': 'SpecStream',
                                name: 'SpecStream[]',
                                children: [
                                {tag: 'option', value: ''},
                                {tag: 'option', value: '1', html: 'Первый поток', selected: function(){return (this.stream == '1')}},
                                {tag: 'option', value: '2', html: 'Второй поток', selected: function(){return (this.stream == '2')}},
                                {tag: 'option', value: '3', html: 'Третий поток', selected: function(){return (this.stream == '3')}}
                                ]
                        }]
                },{
                    tag: 'div',
                    'class': 'form',
                    children: [{
                        tag: 'label',
                        'for': 'SpecLengthServiceSpecial',
                        html: 'Стаж работы <nobr>по специальности (<span class="help">в месяцах</span>):'
                    },{tag: 'br'},{
                        tag: 'input',
                        size: '8',
                        type: 'text',
                        'class': 'SpecLengthServiceSpecial',
                        name: 'SpecLengthServiceSpecial[]',
                        value: '${service}'
                    }]
                },{tag: 'div', 'class': 'clear'},{
                    tag: 'div',
                    'class': 'del-repeater-spec-item',
                    style: 'margin: -30px 10px 0 0',
                    html: '<div id="button_del"><div class="krest"></div></div>'
                }]
        }],
            option:[{tag:'option', value:'${id}', html:'${name}', selected:function(){return this.selected;}}],
            filter:[{
                tag: 'div',
                'class': function(){return 'eduform_filter' + ((this.checked)?' checked':''); },
                children : [{
                    tag: 'input',
                    type: 'checkbox',
                    name: 'filter_${id}',
                    checked: function(){return !!this.checked;},
                    'class': 'edu_form_checkbox'
                },{
                    tag: 'span',
                    html: '${name}'
                }]
            }]
        };


               {% for item in e %}
                $('#repeater-exam-items').json2html({
                    number :'{{item.Number|default:''}}',
                    mark   :'{{item.Mark|default:''}}',
                    name   :'{{item.ExamName.id|default:''}}',
                    docser :'{{item.DocSer|default:''}}',
                    docnum :'{{item.DocNum|default:''}}'
                },repeaterExamItem);
                repeaterExamItemsCount = {{e|length}};
            {% empty %}
                $('#repeater-exam-items').json2html({},repeaterExamItem);
                repeaterExamItemsCount = 1;
            {% endfor %}
                
        $('#repeater-exam-item-adder').on('click',function(){
            if(repeaterExamItemsCount == 5) return false;
            $('#repeater-exam-items').json2html({},repeaterExamItem);
            repeaterExamItemsCount++;
            if(repeaterExamItemsCount == 5) $(this).css('display','none');
            $('select').selectbox();
        }); 

        $('#repeater-exam').on('click', '.del-repeater-exam-item', function(){
            $(this).parent().remove();
            if(repeaterExamItemsCount == 5){
                $('#repeater-exam-item-adder').css('display','');
            }
            repeaterExamItemsCount--;
        });

            /*{# Пробелы уничтожены для генерации более красивого и компактного кода #}
            {% comment %}

            Это генератор данных для генератора элементов '<option>' специальностей и форм обучения, подставляющихся в соответствующие селекты.
            Он нужен для вывода в форму сохранённых данных - списка специальностей, на которые абитуриент подаёт заявление.
            Ему требуется список с сохранёнными объектами выбранных специальностей (модель Fach), а также списки всех специальностей и форм обучения.
            Стуктура такая: (фигурные скобки в коде уничтожены преднамеренно, из-за конфликта с тегами темплейта)
            specData = 
                specs:[
                    id:'',name:'',
                    id:'1',name:'Пример1', id - это id специальности в базе (модель Speciality), name - её название
                    id:'5',name:'Пример2',
                    ...
                    id:'9000',name:'Пример500'
                ],
                eduforms:[
                    id:'',name:'',
                    id:'1',name:'Пример1', id - это id поле в модели FachName (описание её структуры лежит в models.py), name - название формы обучения
                    id:'5',name:'Пример2',
                    ...
                    id:'9000',name:'Пример500'
                ],
                fac: '800', выбранный пользователем факультет
                spec: '4'    выбранная пользователем специальность

            specs заполняется так - циклом пробегается список специальностей и если её факультет совпадает с выбранным, то генерируются данные для - id и name.
            Если её id совпадает с id выбранной специальности, то добавляется опция selected. То же и с eduforms. fac и spec - id выбранных факультета и специальности.

            Структура заполняется и вызывается функция json2html, которая генерирует заполненный элемент
            {% endcomment %}*/


    {% for item in f %}
        specData = {
            specs: get_specs('{{ item.spec_name.id }}'),
            facs: get_facs([{% for fac in item.get_facs %}{{ fac }},{% endfor %}],'{{ item.fac_name.id }}'),
            edu_forms: get_edu_forms([{% for ef in item.get_edu_forms %}{{ ef }}{% if forloop.revcounter0 %},{% endif %}{% endfor %}],[{% for ef in item.get_active_edu_forms %}{{ ef }},{% endfor %}]),

            show_facs: {% if item.spec_name %}true{% else %}false{% endif %},
            show_edu_forms: {% if item.fac_name %}true{% else %}false{% endif %},
            hidden_value: '{% for ef in item.get_active_edu_forms %}{{ ef }}{% if forloop.revcounter0 %},{% endif %}{% endfor %}',

            radio: '{{ forloop.counter }}',
            radio_v: {% if item.Priority %}'{{ item.Priority }}'{% else %}''{% endif %},
            stream: '{{ item.Stream }}',
            service: {% if item.Service %}'{{ item.Service }}'{% else %}''{% endif %}
        };

        {% if item.Priority %}global.spec_ranges[{{forloop.counter0}}]='{{item.Priority}}';{% endif %}
        $('#repeater-spec-items').json2html(specData,repeaterSpecItem.item);
        repeaterSpecItemsCount = {{f|length}};
        if (repeaterSpecItemsCount == 3) $("#repeater-spec-item-adder").css('display','none');
        global.radio_count = {{forloop.counter}};
    {% empty %}
        $('#repeater-spec-items').json2html({
            specs: get_specs(0),
            eduforms:[{id:'',name:''}],
            facs:[{id:'',name:''}],
            radio:'1'
        },repeaterSpecItem.item);
        repeaterSpecItemsCount = 1;
        global.radio_count = 1;
    {% endfor %}

    
        $('#repeater-spec-item-adder').on('click',function(){
            if(repeaterSpecItemsCount == 3) return false;
            repeaterSpecItemsCount++;
            global.radio_count++;
            $('#repeater-spec-items').json2html({ specs:get_specs(0), radio:global.radio_count },repeaterSpecItem.item);
            if(repeaterSpecItemsCount == 3) $(this).css('display','none');
            $('select').selectbox();
        }); 


        $('#repeater-spec').on('click', '.del-repeater-spec-item', function(){
            global.spec_ranges.splice($(this).parent().index(), 1);
            global.spec_ranges.push(0);
            $(this).parent().remove();
            if(repeaterSpecItemsCount == 3) $('#repeater-spec-item-adder').css('display','');
            repeaterSpecItemsCount--;
        });

        $('#schoolSel').on('change',function(){

            if(this.checked){
                $('#edu-list').css('display','none');
                $('#edu-non-list').css('display','');
            } else {
                $('#edu-list').css('display','');
                $('#edu-non-list').css('display','none');
            }


        });

        $('#schoolRjn').on('change',function(){
            $('#schoolCity').parent().css('display','none').val('');
            $('#schoolName').parent().css('display','none').val('');
            if(this.value == ''){

            } else {
                value = this.value;
                $.ajax({
                    type: "GET",
                    url: "/data/?task=loadedulocalities&regionid="+value,
                    dataType: "json"
                }).done(function( msg ) {
                    $('#schoolCity').children().remove();
                    var optionItem = {
                        tag:     'option',
                        value:     '',
                        html:     ''
                    };
                    $('#schoolCity').json2html({},optionItem);
                    for(obj in msg){
                        optionItem.value = ''+msg[obj].id;
                        optionItem.html  = msg[obj].name;
                        $('#schoolCity').json2html({},optionItem);
                    }

                    $('#schoolCity').parent().css('display','');
                    $('#schoolCity').trigger('refresh');

                });
            }
        });

        $('#schoolCity').on('change', function(){
            if(this.value == ''){
                $('#schoolName').parent().css('display','none').val('');
            } else {
                value = this.value;
                $.ajax({
                    type: "GET",
                    url: "/data/?task=loadeduinstitutes&localid="+value,
                    dataType: "json"
                }).done(function( msg ) {
                    $('#schoolName').children().remove();
                    var optionItem = {
                        tag:     'option',
                        value:     '',
                        html:     ''
                    };
                    $('#schoolName').json2html({},optionItem);
                    for(obj in msg){
                        optionItem.value = ''+msg[obj].id;
                        optionItem.html  = msg[obj].name;
                        $('#schoolName').json2html({},optionItem);
                        console.log(optionItem);
                    }

                    $('#schoolName').parent().css('display','');
                    $('#schoolName').trigger('refresh');
                });
            }
        });



        $('#repeater-spec').on('change', '.Speciality', function(){
            var faculty_select = $(this).parent().next().children('.Faculty');
            var education_form_el = $(this).parent().next().next().children('.filter_body');
            education_form_el.empty();
            education_form_el.parent().css('display','none');

            if(this.value == ''){

                faculty_select.val('').parent().css('display','none');
                faculty_select.trigger('refresh');

            } else {

                $.ajax({
                    type: "GET",
                    url: "/data/?task=loadfacs&specid="+this.value,
                    dataType: "json"
                }).done(function( msg ) {
                    faculty_select.children().remove();

                    if (msg.length > 1){
                        faculty_select.json2html({},repeaterSpecItem.option);
                    }

                    for(var i=0; i<msg.length; i++){
                        msg[i].selected = (msg.length == 1);

                        faculty_select.json2html(msg[i],repeaterSpecItem.option);
                    }
                    faculty_select.parent().css('display','');
                    faculty_select.trigger('refresh');
                    if (msg.length == 1) faculty_select.change();
                });
            }
        });


        $('#repeater-spec').on('change', '.Faculty', function(){
            var speciality_select = $(this).parent().prev().children('.Speciality');
            var education_form_el = $(this).parent().next().children('.filter_body');

            var spo = ($('#EduEducationType').val() == 4);
            if(this.value == ''){
                education_form_el.empty();
                education_form_el.parent().css('display','none');
            } else {
                education_form_el.empty();
                $.ajax({
                    type: "GET",
                    url: "/data/?task=loadeduforms&facid="+this.value+'&specid='+speciality_select.val()+'&onlyspo='+((spo)?'1':'0'),
                    dataType: "json"
                }).done(function( msg ) {
                    education_form_el.parent().css('display','');
                    if (msg.length != 0){
                        var efs = get_edu_forms(msg, []);
                        for(var e in efs){
                            education_form_el.json2html(efs[e],repeaterSpecItem.filter);
                            education_form_el.parent().children().last().empty().css('display','none');
                        }
                    } else {
                        education_form_el.parent().children().last().html('<span class="error">Вы выбрали <b>основное полное общее образование</b>, и не можете учиться по этому направлению на этом факультете</span>');
                        education_form_el.parent().children().last().css('display','block');
                    }
                });
            }
        });


        $('#repeater-spec').on('change', '.SpecRangeRadio', function(){

            //Присваиваем скрытому полю значение выбранного радио
            $(this).parents().eq(4).children('.SpecRange').val(this.value);
            //Номер repeater-item-родителя в общем репитере
            index = $(this).parents().eq(5).index();
            //Перебираем все хранящиеся значения
            for(i in global.spec_ranges){
                //Если в другом repeater-item уже выбрано такое значение
                if(i!=index && global.spec_ranges[i]==this.value){
                    //Устанавливаем другому элементу предыдущее значение текущего
                    global.spec_ranges[i]=global.spec_ranges[index];
                    //Берём все радио в другом repeater-item
                    //Сначала берём все ячейки из второй строки из таблицы с радио
                    var tds = $(this).parents().eq(6).children().eq(i).children().eq(4).children().eq(0).children().eq(0).children().eq(1).children('td');
                    var radios = [];
                    //Потом из каждоый ячейки (начиная с первой) достаём радио
                    for(i = 1; i<tds.length; i++){
                        radios.push(tds[i].childNodes[0]);
                    }

                    //Нужный включаем, остальные выключаем
                    for(r=0;r<radios.length;r++){
                        radios[r].checked=(radios[r].value == global.spec_ranges[index]);
                    }
                    $(radios).parents().eq(6).children('.SpecRange').val(global.spec_ranges[index]);
                }
            }
            //Ставим текущему элементу его нынешнее значение
            global.spec_ranges[index]=this.value;
        });


        $('#repeater-spec').on('change', '.edu_form_checkbox', function(){
            var v = !!this.checked;
            var hid = $(this).parents().eq(2).children('input[type=hidden]');
            var tmp;
            if (v){
                $(this).parent().addClass('checked');
                var new_val = (hid.val())?hid.val() + ',' + this.name.slice(7):this.name.slice(7);
                hid.val(new_val);
            } else {
                $(this).parent().removeClass('checked');
                tmp = [];
                var tmp2 = hid.val().split(',');
                for(var i in tmp2){
                    if(tmp2[i] == this.name.slice(7)) continue;
                    tmp.push(tmp2[i]);
                }
                hid.val(tmp.join(','))
            }
            tmp = hid.val().split(',');
            var l=false;
            for (i=0;i<tmp.length;i++){
                if (tmp[i] == 16 || tmp[i] == 17 || tmp[i] == 19){
                    l = true;
                    break;
                }
            }
            if (l){
                $(this).parents().eq(2).children('.message').html('Для поступления на целевой набор, вы должны предоставить договор с предприятием').css('display','block');
            } else {
                $(this).parents().eq(2).children('.message').html('').css('display','none');
            }
        });


        $('#repeater-spec').on('click', '.eduform_filter', function(e){
            if (e.target.className == 'edu_form_checkbox') return true;
            else {
                var checkbox = $(this).children().eq(0).click();
            }
        });

        $('select').selectbox();
    });
</script>

<script type="text/javascript">
function validate(selector, elem){
    var russian = ($('#Citizenship').val() == 10);
    switch (selector){
        case '#PassportSer':
            return ( !elem.val() || !russian || elem.val().match(/^(\d{4})$/g) != null);
            break;

        case '#PassportNumb':
            return ( !elem.val() || !russian || elem.val().match(/^(\d{6})$/g) != null);
            break;

        case '#CodUVD':
            return ( !elem.val() || !russian || elem.val().match(/^(\d{3})-(\d{3})$/g) != null);
            break;

        case '.EgNumber':
            return ( !elem.val() || !russian || elem.val().match(/^(\d{2})-(\d{9})-(\d{2})$/g) != null);
            break;

    }
}

$(document).ready(function(){
    id = ['#PassportSer', '#PassportNumb', '#CodUVD'];
    for (var i in id ){
        $(id[i]).on('keyup', function(){
            if (validate('#'+this.id, $(this))){
                $(this).parent().removeClass('error');
            }
        });

        $(id[i]).on('change', function(){
            if (validate('#'+this.id, $(this))){
                $(this).parent().removeClass('error');
            } else {
                $(this).parent().addClass('error');
            }
        });
    }

    $('#repeater-exam').on('keyup', '.EgNumber', function(){
        if (validate('.EgNumber', $(this))){
            $(this).parent().removeClass('error');
        }
    });

    $('#repeater-exam').on('change', '.EgNumber', function(){
        if (validate('.EgNumber', $(this))){
            $(this).parent().removeClass('error');
        } else {
            $(this).parent().addClass('error');
        }
    });

    $('form#glForm').submit(function(){
        var failed_elem = false;
        var elem;

        elem = $('#PassportSer');
        if (!validate('#PassportSer', elem)){
            elem.parent().addClass('error');
            if(!failed_elem) failed_elem = elem;
        }

        elem = $('#PassportNumb');
        if (!validate('#PassportNumb', elem)){
            elem.parent().addClass('error');
            if(!failed_elem) failed_elem = elem;
        }

        elem = $('#CodUVD');
        if (!validate('#CodUVD', elem)){
            elem.parent().addClass('error');
            if(!failed_elem) failed_elem = elem;
        }

        $('.EgNumber').each(function(){
            elem = $(this);
            if (!validate('.EgNumber', elem)){
                elem.parent().addClass('error');
                if(!failed_elem) failed_elem = elem;
            }
        });

        console.log(failed_elem);
        if (failed_elem){
            $('html, body').animate({
                scrollTop: failed_elem.offset().top - 200
            }, 200);
            return false;
        }
    });

    
})

</script>
{% endblock %}